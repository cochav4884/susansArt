<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Art Tracker</title>

  <link rel="icon" type="image/png" href="public/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="public/favicon.svg" />
  <link rel="shortcut icon" href="public/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="public/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="susansArt" />
  <link rel="manifest" href="public/site.webmanifest" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles/index.css">
</head>

<body>

<header class="nav">
  <a href="index.html" class="back-btn">
    <img src="public/favicon.ico" alt="Art Tracker Logo" class="nav-avatar">
  </a>
  <span class="nav-brand">ğŸ¨ Art Tracker</span>
</header>

<section class="jumbotron">
  <div>
    <img src="images/susan.jpg" alt="Picture of Artist Susan" class="jumbotron-avatar">
    <h1>Artist: <span class="artist-name">Susan</span></h1>
    <p>Track every art project from concept to completion.</p>
  </div>
</section>

<main>
  <section id="cardsContainer"></section>

  <div class="controls">
    <button type="button" id="addCard">â• Add Project</button>
    <button type="button" id="resetAll">ğŸ”„ Reset All</button>
  </div>
</main>

<footer class="site-footer">
  <p>&copy; 2026 Susan. All rights reserved.</p>
  <p>
    <a href="privacyPolicy.html">ğŸ”’ Privacy Policy</a> |
    <a href="legalDisclaimer.html">ğŸ“„ Legal Disclaimer</a>
  </p>
</footer>

<script>
const STORAGE_KEY = "artCards";
const STAGES = ["Concept", "Sketch", "In Progress", "Original", "Completed"];
const MEDIUMS = ["Pencil","Paint","Digital","Charcoal","Pen","Sharpie","Marker","Gel Pen","White Out"];

/* ---------- CARD MODEL ---------- */
function createEmptyCard() {
  return {
    title: "",
    stages: Array(5).fill(false),
    images: Array(5).fill(null).map(() => []),
    startDate: "",
    completionDate: "",
    medium: [],
    notes: ""
  };
}

/* ---------- STORAGE ---------- */
function loadCards() {
  const data = localStorage.getItem(STORAGE_KEY);
  if (!data) return [];
  return JSON.parse(data);
}

function saveCards(cards) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(cards));
}

/* ---------- IMAGE RESIZE ---------- */
function resizeImage(file, callback) {
  const img = new Image();
  const reader = new FileReader();

  reader.onload = e => img.src = e.target.result;

  img.onload = () => {
    const canvas = document.createElement("canvas");
    const max = 800;
    let { width, height } = img;

    if (width > height && width > max) {
      height *= max / width;
      width = max;
    } else if (height > max) {
      width *= max / height;
      height = max;
    }

    canvas.width = width;
    canvas.height = height;
    canvas.getContext("2d").drawImage(img, 0, 0, width, height);
    callback(canvas.toDataURL("image/jpeg", 0.8));
  };

  reader.readAsDataURL(file);
}

/* ---------- RENDER ---------- */
function renderCards() {
  const container = document.getElementById("cardsContainer");
  container.innerHTML = "";

  const cards = loadCards();

  if (cards.length === 0) {
    const newCard = createEmptyCard();
    cards.push(newCard);
    saveCards(cards);
  }

  cards.forEach((card, index) => {
    const cardEl = document.createElement("div");
    cardEl.className = "art-card collapsed"; // collapse all by default
    const isCompleted = card.stages[4];

    cardEl.innerHTML = `
      <div class="title-container">
        <input class="title" placeholder="Project Title" value="${card.title}">
        <button class="btn delete">ğŸ—‘ï¸</button>
      </div>

      <div class="card-content">
        <div class="stages">
          ${STAGES.map((s,i)=>`
            <div class="stage-block">
              <label>
                <input type="checkbox" ${card.stages[i] ? "checked" : ""}>
                ${s}
              </label>
              <input type="file" accept="image/*" data-stage="${i}" multiple>
              <div class="image-preview">
                ${(card.images[i] || []).map((img, imgIndex) => `
                  <div class="preview-container">
                    <img src="${img}">
                    <button class="remove-image" data-stage="${i}" data-index="${imgIndex}">âŒ</button>
                  </div>
                `).join("")}
              </div>
            </div>
          `).join("")}
        </div>

        <fieldset class="medium">
          <legend>Medium</legend>
          ${MEDIUMS.map(m => `
            <label>
              <input type="checkbox" value="${m}" ${card.medium.includes(m) ? "checked" : ""}>
              ${m}
            </label>
          `).join("")}
        </fieldset>

        <div class="extras">
          <label>Start Date <input type="date" value="${card.startDate}"></label>
          <label>Completion Date <input type="date" value="${card.completionDate}"></label>
        </div>

        <textarea placeholder="Notes...">${card.notes}</textarea>

        <div class="card-actions">
          <button class="btn view-art" ${isCompleted ? "" : "style='display:none'"}>ğŸ¨ View Art</button>
          <button class="btn reset">ğŸ”„ Reset</button>
        </div>
      </div>
    `;

    const titleContainer = cardEl.querySelector(".title-container");
    const titleInput = cardEl.querySelector(".title");

    // ---------- ACCORDION ----------
    titleContainer.onclick = e => {
      if (e.target.classList.contains("delete")) return;
      if (e.target !== titleContainer && e.target !== titleInput) return;

      // Close all other cards
      document.querySelectorAll(".art-card").forEach(c => {
        if (c !== cardEl) c.classList.add("collapsed");
      });

      cardEl.classList.toggle("collapsed");
    };

    // ---------- DATA HANDLERS ----------
    titleInput.oninput = e => {
      cards[index].title = e.target.value;
      saveCards(cards);
    };

    cardEl.querySelector(".delete").onclick = () => {
      if (confirm("Delete this project?")) {
        cards.splice(index, 1);
        saveCards(cards);
        renderCards();
      }
    };

 // Stage checkboxes
cardEl.querySelectorAll(".stages input[type=checkbox]").forEach((box,i)=>{
  box.onchange = e => {
    cards[index].stages[i] = e.target.checked;
    const viewArtBtn = cardEl.querySelector(".view-art");

    // If Completed stage is checked
    if(i === 4) {
      if(e.target.checked) {
        cards[index].completionDate = new Date().toISOString().split("T")[0];
        viewArtBtn.style.display = "inline-block"; // show the button
      } else {
        viewArtBtn.style.display = "none"; // hide if unchecked
      }
    }

    saveCards(cards);
  };
});


    // File uploads
    cardEl.querySelectorAll("input[type=file]").forEach(input=>{
      input.onchange = e => {
        const stage = +input.dataset.stage;
        [...e.target.files].forEach(file=>{
          resizeImage(file, img=>{
            cards[index].images[stage].push(img);
            saveCards(cards);

            // Add new preview only
            const previewContainer = cardEl.querySelectorAll(".stage-block")[stage].querySelector(".image-preview");
            const frame = document.createElement("div");
            frame.className = "preview-container";

            const imgEl = document.createElement("img");
            imgEl.src = img;
            frame.appendChild(imgEl);

            const removeBtn = document.createElement("button");
            removeBtn.className = "remove-image";
            removeBtn.textContent = "âŒ";
            removeBtn.dataset.stage = stage;
            removeBtn.dataset.index = cards[index].images[stage].length - 1;
            removeBtn.onclick = () => {
              cards[index].images[stage].splice(removeBtn.dataset.index,1);
              saveCards(cards);
              frame.remove();
            };
            frame.appendChild(removeBtn);

            previewContainer.appendChild(frame);
          });
        });
      };
    });

    // Remove existing image buttons
    cardEl.querySelectorAll(".remove-image").forEach(btn=>{
      btn.onclick = e=>{
        const { stage, index: imgIndex } = btn.dataset;
        cards[index].images[stage].splice(imgIndex,1);
        saveCards(cards);
        btn.parentElement.remove();
      };
    });

    // Medium checkboxes
    cardEl.querySelectorAll("fieldset.medium input").forEach(cb=>{
      cb.onchange = e=>{
        if (e.target.checked) {
          cards[index].medium.push(e.target.value);
        } else {
          cards[index].medium = cards[index].medium.filter(m=>m!==e.target.value);
        }
        saveCards(cards);
      };
    });

    // Dates
    const dateInputs = cardEl.querySelectorAll("input[type=date]");
    dateInputs[0].onchange = e => { cards[index].startDate = e.target.value; saveCards(cards); };
    dateInputs[1].onchange = e => { cards[index].completionDate = e.target.value; saveCards(cards); };

    // Notes
    cardEl.querySelector("textarea").oninput = e => { cards[index].notes = e.target.value; saveCards(cards); };

    // View art
    cardEl.querySelector(".view-art").onclick = () => {
      localStorage.setItem("activeArtIndex", index);
      window.location.href = "art.html";
    };

    // Reset card
    cardEl.querySelector(".reset").onclick = () => {
      cards[index] = createEmptyCard();
      saveCards(cards);
      renderCards();
    };

    container.appendChild(cardEl);
  });
}

// ---------- BUTTONS ----------
document.getElementById("addCard").onclick = () => {
  const cards = loadCards();
  cards.push(createEmptyCard());
  saveCards(cards);
  renderCards();
};

document.getElementById("resetAll").onclick = () => {
  if (confirm("Reset all projects?")) {
    localStorage.removeItem(STORAGE_KEY);
    renderCards();
  }
};

// Initial render
renderCards();
</script>

</body>
</html>
